<div class="card h-100 shadow-sm border-0 transition-hover">
    <div class="ratio ratio-4x3">
        <img src="<%= trip.image_url || '/images/default-trip.jpg' %>"
             class="card-img-top rounded-top" 
             style="object-fit: cover;" 
             alt="<%= trip.title %>">
    </div>
    <div class="card-body">
        <h5 class="card-title fw-bold text-primary"><%= trip.title %></h5>
        <div class="card-text text-muted small mb-3">
            <div><i class="bi bi-calendar-check"></i> <%= trip.start_date %> 〜</div>
            <div><i class="bi bi-calendar-x"></i> <%= trip.end_date %></div>
        </div>
        
        <div class="mb-3">
            <p class="text-muted mb-2" style="font-size: 0.7rem; font-weight: bold;">参加メンバー</p>
            <div class="d-flex flex-wrap gap-2">
                <% 
                    // 1. 全ての参加候補を一つの配列に入れる
                    let allParticipants = [];
                    if (trip.Owner) allParticipants.push(trip.Owner);
                    if (trip.Members && trip.Members.length > 0) {
                        allParticipants = allParticipants.concat(trip.Members);
                    }
        
                    // 2. IDが重複しているユーザーを除外（作成者がメンバーにも含まれる場合があるため）
                    const uniqueMembers = allParticipants.filter((user, index, self) =>
                        index === self.findIndex((u) => u.id === user.id)
                    );
                %>
                
                <% uniqueMembers.forEach(member => { %>
                    <div class="text-center" title="<%= member.username %>">
                        <img src="<%= member.profile_image ? member.profile_image : 'https://ui-avatars.com/api/?name=' + encodeURIComponent(member.username) + '&background=random&color=fff' %>" 
                             class="rounded-circle border shadow-sm" 
                             style="width: 32px; height: 32px; object-fit: cover;" 
                             alt="<%= member.username %>">
                    </div>
                <% }) %>
        
                <% if (uniqueMembers.length === 0) { %>
                    <span class="text-muted small">メンバーはいません</span>
                <% } %>
            </div>
        </div>
        
        <a href="/trip_detail/<%= trip.id %>" class="btn btn-primary btn-sm w-100 mt-2">詳細を見る</a>
    </div>
</div>

<style>
    .transition-hover:hover { transform: translateY(-5px); transition: 0.3s; }
</style>